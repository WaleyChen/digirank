if (typeof twilio == "undefined") { var twilio = {}; } twilio.realm = "prod"; $(document).ready(function(e){var closeDialog=function(obj){$(".help-bubble-button").RemoveBubblePopup();obj.w.fadeOut('fast',function(){obj.o.remove();}).find("input").val("").end().find(".error").hide();};var addCallerIDDialog=$("#add-caller-id-dialog").jqm({onHide:closeDialog});var addCallerIDInCallDialog=$("#add-caller-id-in-call-dialog").jqm({onHide:closeDialog,modal:true});$("#caller-id-fieldset .help-bubble-button").CreateBubblePopup().mouseover(function(e){var that=$(this),bubbleTarget=that.attr("rel"),bubbleText=$("#"+bubbleTarget).html();that.SetBubblePopupOptions({innerHtml:bubbleText,position:'bottom',themePath:'/packages/base/images/jquerybubblepopup-theme',themeName:'all-black'});that.ShowBubblePopup();});$("#add-caller-id-button").add(".validate-caller-id-link").click(function(e){addCallerIDDialog.jqmShow();e.preventDefault();});$("#add-caller-id-submit-button").click(function(e){e.preventDefault();var button=$(this).hide();var error=$("#add-caller-id-error").hide();var exten=$("#caller-id-extension-input").val();var number=$("#caller-id-phone-number-input").val();if(exten.length){var _gaq=window._gaq||[];_gaq.push(['_trackEvent','portal','verified-number-extension',number+" "+exten]);}
$.ajax({type:"post",dataType:"xml",url:"/user/account/phone-numbers/verified",data:{extension:exten,phoneNumber:number},error:function(xml){button.show();error.text("The request could not be processed").show();},success:function(xml){var xml=$(xml);button.show();if(xml.children("TwilioResponse").children("RestException").length){error.text(xml.find("Message").text()).show();}else{addCallerIDDialog.jqmHide();var pin=xml.find("ValidationCode").text();var number=xml.find("PhoneNumber").text();addCallerIDInCallDialog.jqmShow().find("#twilio-call").text("Twilio is calling: "+number).end().find("#twilio-pin").text(pin);}}});});});